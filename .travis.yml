sudo: required

language: python

services:
  - docker

python:
  - 3.6

before_script:
  - docker-compose -f docker-compose.travis.yml up --build -d 
  - docker ps -a
  - sleep 15  # wait for PostgreSQl and Elasticsearch to start

script:
  # use --keepdb to avoid OperationalError during teardown in case any
  # db connections are still open from threads in TransactionTestCases
  - docker exec cyphondock_cyphon_1 python manage.py test --noinput --keepdb
  
after_script:
  - docker-compose down
